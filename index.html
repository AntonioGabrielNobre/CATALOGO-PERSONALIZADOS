<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Madean Joias - Sistema</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="Styles.css">
</head>

<body>

    <div id="loginScreen" class="login-overlay">
        <div class="login-box">
            <span class="brand">Madean <strong>joias</strong></span>
            <h2>Acesso ao Sistema</h2>
            <input type="text" id="userLogin" placeholder="Usu√°rio">
            <input type="password" id="userPass" placeholder="Senha">
            <button onclick="handleLogin()" id="btnLogin">Entrar</button>
        </div>
    </div>

    <div id="mainApp" style="display: none; overflow-x: hidden;">
        <nav class="navbar">
            <div class="container nav-content">
                <button onclick="openOrderModal(null)" class="btn-main-order"
                    style="margin: 10px 0; width: auto; padding: 10px 20px;">
                    ‚ûï Novo Pedido Manual
                </button>

                <div id="orderEditorModal" class="modal">
                    <div class="expanded-card">
                        <span class="close-modal" onclick="closeOrderEditor()">√ó</span>
                        <div class="expanded-info">
                            <h2 id="editorTitle">Lan√ßar Novo Pedido</h2>
                            <div class="order-form-container">
                                <input type="hidden" id="edit_id">

                                <div class="input-group">
                                    <label>C√≥digo da Pe√ßa</label>
                                    <input type="text" id="edit_codigo" placeholder="Digite o c√≥digo..."
                                        onchange="fetchProductDetails(this.value)">
                                </div>

                                <div class="input-group">
                                    <label>Descri√ß√£o do Produto</label>
                                    <input type="text" id="edit_produto" readonly style="background:#eee">
                                </div>

                                <div class="detail-grid">
                                    <div class="input-group">
                                        <label>Quantidade</label>
                                        <input type="number" id="edit_quantidade" value="1">
                                    </div>
                                    <div class="input-group">
                                        <label>Banho</label>
                                        <select id="edit_banho">
                                            <option value="OURO">OURO</option>
                                            <option value="PRATA">PRATA</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label>Cliente</label>
                                    <input type="text" id="edit_cliente">
                                </div>

                                <div class="input-group">
                                    <label>Loja</label>
                                    <select id="edit_loja">
                                        <option value="MADEAN JOIAS QUIXADA">MADEAN JOIAS QUIXADA</option>
                                        <option value="MADEAN JOIAS FORTALEZA">MADEAN JOIAS FORTALEZA</option>
                                        <option value="MADEAN JOIAS IGUATU 1">MADEAN JOIAS IGUATU 1</option>
                                        <option value="MADEAN JOIAS IGUATU 2">MADEAN JOIAS IGUATU 2</option>
                                        <option value="MADEAN JOIAS LIMOEIRO">MADEAN JOIAS LIMOEIRO</option>
                                        <option value="MADEAN JOIAS MARANGUAPE">MADEAN JOIAS MARANGUAPE</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label>Status</label>
                                    <select id="edit_status">
                                        <option value="EM ABERTO">EM ABERTO</option>
                                        <option value="PRODUZINDO">PRODUZINDO</option>
                                        <option value="FEITO">FEITO</option>
                                        <option value="ENTREGUE">ENTREGUE</option>
                                    </select>
                                </div>

                                <div class="input-group">
                                    <label>Data do Pedido</label>
                                    <input type="date" id="edit_data_pedido">
                                </div>

                                <div class="input-group">
                                    <label>Observa√ß√µes (Emojis Permitidos)</label>
                                    <textarea id="edit_observacao" rows="3"></textarea>
                                </div>

                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    <button class="btn-confirm-final" onclick="saveOrder()" style="flex: 2;">SALVAR
                                        PEDIDO</button>
                                    <button id="btnDeleteOrder" class="btn-confirm-final" onclick="deleteOrder()"
                                        style="flex: 1; background: var(--danger); display: none;">APAGAR</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <span class="brand">Madean <strong>joias</strong></span>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="statusIndicator" class="status-badge">Sincronizado</div>
                    <button onclick="logout()" class="btn-logout">Sair</button>
                </div>
            </div>
        </nav>

        <div id="swipeWrapper" class="tabs-content">

            <div id="adminPanel" class="tab-panel container" style="margin-top: 20px;">
                <div class="filter-section"
                    style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; align-items: end; box-shadow: var(--shadow);">
                    <div>
                        <label style="font-size: 0.8rem; font-weight: 600;">Data Inicial</label>
                        <input type="date" id="filterStart" style="width: 100%;">
                    </div>
                    <div>
                        <label style="font-size: 0.8rem; font-weight: 600;">Data Final</label>
                        <input type="date" id="filterEnd" style="width: 100%;">
                    </div>
                    <div>
                        <label style="font-size: 0.8rem; font-weight: 600;">Filtrar Loja</label>
                        <select id="filterStore" style="width: 100%;">
                            <option value="all">Todas as Lojas</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <input type="text" id="quickSearch" placeholder="üîç Buscar por cliente ou c√≥digo..."
                            oninput="filterByText(this.value)">
                    </div>
                    <button onclick="applyFilters()"
                        style="background: var(--dark); color: white; height: 45px; border-radius: 8px; cursor: pointer;">Aplicar
                        Filtros</button>
                </div>

                <section class="grid-stats">
                    <div class="stat-card">
                        <h3>Pedidos no Per√≠odo</h3>
                        <p id="stat-total">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Aguardando Produ√ß√£o</h3>
                        <p id="stat-pendente">0</p>
                    </div>
                </section>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div
                        style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--shadow); min-height: 300px;">
                        <h4 style="margin-bottom: 15px;">Status dos Pedidos</h4>
                        <canvas id="statusChart"></canvas>
                    </div>
                    <div
                        style="background: white; padding: 20px; border-radius: 12px; box-shadow: var(--shadow); min-height: 300px;">
                        <h4 style="margin-bottom: 15px;">Pedidos por Loja</h4>
                        <canvas id="storeChart"></canvas>
                    </div>
                </div>

                <h3>Gerenciar Pedidos</h3>
                <div id="ordersList" class="catalog-grid"></div>
            </div>

            <div id="catalogPanel" class="tab-panel container" style="margin-top: 20px;">
                <header class="search-wrapper">
                    <input type="text" id="searchBar" placeholder="Pesquisar por nome ou c√≥digo da pe√ßa...">
                </header>
                <h2>Cat√°logo de Estoque</h2>
                <div id="catalog" class="catalog-grid"></div>
            </div>

        </div>
    </div>

    <div id="expandedCardModal" class="modal" style="display:none;">
        <div class="modal-content expanded-card">
            <span class="close-modal" onclick="closeExpandedModal()">&times;</span>

            <div class="expanded-layout">
                <div class="expanded-img-container">
                    <img id="exp_img" src="" alt="Produto">
                </div>

                <div class="expanded-info">
                    <h2 id="exp_nome" class="modal-title">Nome do Produto</h2>
                    <div class="product-meta">
                        <span><strong>REF:</strong> <span id="exp_codigo"></span></span>
                        <span><strong>BANHO:</strong> <span id="exp_banho"></span></span>
                    </div>

                    <button id="btnInitialOrder" onclick="showOrderStep2()" class="btn-main-order">Lan√ßar
                        Pedido</button>

                    <div id="orderFields" class="order-form-container" style="display: none;">
                        <div class="input-group">
                            <label>Modelo de Grava√ß√£o</label>
                            <select id="m_gravacao">
                                <option value="FOTOGRAVA√á√ÉO">FOTOGRAVA√á√ÉO</option>
                                <option value="GRAVA√á√ÉO">GRAVA√á√ÉO</option>
                                <option value="DESENHO">DESENHO</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label>Nome do Cliente</label>
                            <input type="text" id="m_cliente_nome" placeholder="Nome completo do cliente">
                        </div>

                        <div class="input-group">
                            <label>Observa√ß√µes do Pedido</label>
                            <textarea id="m_observacoes" rows="4"
                                placeholder="Descreva aqui os detalhes da personaliza√ß√£o, links de fotos ou instru√ß√µes especiais..."></textarea>
                        </div>

                        <div class="vendedor-info">
                            <span class="label">Vendedor/Loja:</span>
                            <span id="m_vendedor_auto" class="value">---</span>
                        </div>

                        <button onclick="processOrder()" class="btn-confirm-final">Finalizar e Enviar WhatsApp</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="Script.js"></script>
</body>

</html>